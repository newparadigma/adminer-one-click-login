name: test

on:
  pull_request:
    branches:
      - main

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."

      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "💡 The ${{ github.repository }} repository has been cloned to the runner."

      - name: List files in the repository
        run: ls ${{ github.workspace }}

      - name: Start Docker Compose services
        run: docker-compose up -d

      - name: Wait for services to be up
        run: sleep 30

      # - name: Check for login button
      #   uses: actions/github-script@v7
      #   with:
      #     script: |
      #       const { chromium } = require('playwright');
      #       (async () => {
      #         const browser = await chromium.launch();
      #         const page = await browser.newPage();
      #         await page.goto('http://localhost:80');
      #         await page.waitForSelector('button:has-text("Enter")');
      #         await page.click('button:has-text("Enter")');
      #         await page.waitForFunction('document.body.innerText.includes("Database: local")');
      #         await browser.close();
      #       })();
      #     result-encoding: string
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Stop Docker Compose services
        run: docker-compose down

      - run: echo "🍏 This job's status is ${{ job.status }}."


# name: GitHub Actions Demo
# run-name: ${{ github.actor }} is testing out GitHub Actions 🚀
# on: [push]
# jobs:
#   Explore-GitHub-Actions:
#     runs-on: ubuntu-latest
#     steps:
#       - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
#       - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
#       - run: echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
#       - name: Check out repository code
#         uses: actions/checkout@v4
#       - run: echo "💡 The ${{ github.repository }} repository has been cloned to the runner."
#       - run: echo "🖥️ The workflow is now ready to test your code on the runner."
#       - name: List files in the repository
#         run: |
#           ls ${{ github.workspace }}
#       - run: echo "🍏 This job's status is ${{ job.status }}."